/**
 * NORMAND PLLC - MOBILE NAVIGATION
 * Responsive navigation functionality for law firm website
 * Generated by comprehensive responsive design audit
 */

document.addEventListener('DOMContentLoaded', function() {
  
  // Create hamburger menu button if it doesn't exist
  function createHamburgerMenu() {
    const nav = document.querySelector('.main-navigation, .nav-menu, .navigation-menu');
    if (!nav) return;
    
    // Check if hamburger already exists
    let hamburger = document.querySelector('.hamburger-menu');
    if (!hamburger) {
      // Create hamburger button
      hamburger = document.createElement('button');
      hamburger.className = 'hamburger-menu';
      hamburger.setAttribute('aria-label', 'Toggle mobile menu');
      hamburger.setAttribute('aria-expanded', 'false');
      hamburger.innerHTML = `
        <span class="sr-only">Toggle mobile menu</span>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      `;
      
      // Insert hamburger button before navigation
      nav.parentNode.insertBefore(hamburger, nav);
    }
    
    return hamburger;
  }
  
  // Initialize mobile navigation
  function initMobileNavigation() {
    const hamburger = createHamburgerMenu();
    if (!hamburger) return;
    
    const nav = document.querySelector('.main-navigation, .nav-menu, .navigation-menu');
    if (!nav) return;
    
    // Toggle mobile menu
    hamburger.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const isActive = document.body.classList.contains('mobile-nav-active');
      
      if (isActive) {
        // Close menu
        document.body.classList.remove('mobile-nav-active');
        hamburger.setAttribute('aria-expanded', 'false');
        hamburger.innerHTML = `
          <span class="sr-only">Toggle mobile menu</span>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        `;
      } else {
        // Open menu
        document.body.classList.add('mobile-nav-active');
        hamburger.setAttribute('aria-expanded', 'true');
        hamburger.innerHTML = `
          <span class="sr-only">Close mobile menu</span>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        `;
      }
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
      if (!hamburger.contains(e.target) && !nav.contains(e.target)) {
        document.body.classList.remove('mobile-nav-active');
        hamburger.setAttribute('aria-expanded', 'false');
        hamburger.innerHTML = `
          <span class="sr-only">Toggle mobile menu</span>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        `;
      }
    });
    
    // Close menu when clicking on navigation links
    const navLinks = nav.querySelectorAll('a');
    navLinks.forEach(link => {
      link.addEventListener('click', function() {
        document.body.classList.remove('mobile-nav-active');
        hamburger.setAttribute('aria-expanded', 'false');
        hamburger.innerHTML = `
          <span class="sr-only">Toggle mobile menu</span>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        `;
      });
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
      if (window.innerWidth > 768) {
        // Close mobile menu on desktop
        document.body.classList.remove('mobile-nav-active');
        hamburger.setAttribute('aria-expanded', 'false');
      }
    });
    
    // Keyboard navigation support
    hamburger.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        hamburger.click();
      }
      
      if (e.key === 'Escape') {
        document.body.classList.remove('mobile-nav-active');
        hamburger.setAttribute('aria-expanded', 'false');
        hamburger.focus();
      }
    });
    
    // Trap focus within mobile menu when open
    nav.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.body.classList.remove('mobile-nav-active');
        hamburger.setAttribute('aria-expanded', 'false');
        hamburger.focus();
      }
    });
  }
  
  // Touch target improvement for small interactive elements
  function improveTouchTargets() {
    // Find all interactive elements that might be too small
    const interactiveElements = document.querySelectorAll('button, a, input, select, textarea');
    
    interactiveElements.forEach(element => {
      // Skip if element already has adequate sizing classes
      if (element.classList.contains('touch-friendly') || 
          element.classList.contains('btn-large') ||
          element.closest('.hamburger-menu')) {
        return;
      }
      
      // Add touch-friendly class for styling
      element.classList.add('touch-target');
    });
  }
  
  // Improve form experience on mobile
  function improveFormExperience() {
    const forms = document.querySelectorAll('form');
    
    forms.forEach(form => {
      // Prevent iOS zoom on form inputs
      const inputs = form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea');
      inputs.forEach(input => {
        // Ensure font size is at least 16px to prevent zoom
        const computedStyle = window.getComputedStyle(input);
        const fontSize = parseInt(computedStyle.fontSize);
        if (fontSize < 16) {
          input.style.fontSize = '16px';
        }
      });
      
      // Add better validation feedback
      const submitButton = form.querySelector('input[type="submit"], button[type="submit"]');
      if (submitButton) {
        form.addEventListener('submit', function(e) {
          // Add loading state
          submitButton.disabled = true;
          submitButton.textContent = 'Submitting...';
          
          // Re-enable after 3 seconds (in case of form submission issues)
          setTimeout(() => {
            submitButton.disabled = false;
            submitButton.textContent = 'Submit';
          }, 3000);
        });
      }
    });
  }
  
  // Initialize all responsive features
  function init() {
    initMobileNavigation();
    improveTouchTargets();
    improveFormExperience();
    
    // Add loaded class to body for CSS transitions
    document.body.classList.add('responsive-js-loaded');
    
    console.log('Normand PLLC responsive navigation initialized');
  }
  
  // Initialize when DOM is ready
  init();
  
});